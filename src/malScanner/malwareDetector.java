package malScanner;

import java.io.IOException;

import javax.xml.parsers.ParserConfigurationException;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import util.Const;

public class malwareDetector {
	
	public malwareDetector() {
		
	}

	public void checkKeywords(mScanner scanner, Document doc) throws ParserConfigurationException, SAXException, IOException {
	
	    Element element = doc.getDocumentElement();
		NodeList nodes = element.getElementsByTagName(Const.USES_PERMISSION);
		
		if(nodes.getLength() == 0) {
			scanner.setMalignPermissionCounter(0);
			scanner.setNormalPermissionCounter(0);
			scanner.setTotalPermissionCounter(0);
		}
		else {
			// variable for counting permission
			int nPermission = 0, mPermission = 0, tPermission = 0;
			for (int temp = 0; temp < nodes.getLength(); temp++) { 
				Node nNode = nodes.item(temp);  
				Element eElement = (Element) nNode;
				tPermission++;
				String tmpPermission = eElement.getAttribute(Const.ATTRIBUTE_NAME);
				for(int j = 0; j < Const.MALIGN_PERMISSION.length; j++) {
					if(tmpPermission.contains(Const.MALIGN_PERMISSION[j]))
						mPermission++;
				}
				for(int j = 0;  j < Const.NORMAL_PERMISSION.length; j++) {
					if(tmpPermission.contains(Const.NORMAL_PERMISSION[j]))
						nPermission++;
				}
			}
			scanner.setMalignPermissionCounter(mPermission);
			scanner.setNormalPermissionCounter(nPermission);
			scanner.setTotalPermissionCounter(tPermission);
		}
		
		NodeList ifList = element.getElementsByTagName(Const.IF_ACTION);
		if(ifList.getLength() == 0) {
			scanner.setTotalIfCounter(0);
			scanner.setMalignIfCounter(0);
		}
		else {
			int mIntentFilter= 0, tIntentFilter= 0;
			for(int tmp = 0; tmp < ifList.getLength(); tmp++) {
				Node ifNode = ifList.item(tmp);  
				Element ifElement = (Element) ifNode;
				tIntentFilter++;
				String tmpIf = ifElement.getAttribute(Const.ATTRIBUTE_NAME);
				for(int j = 0; j < Const.MALIGN_INTENT_FILTER.length; j++) {
					if(tmpIf.contains(Const.MALIGN_INTENT_FILTER[j]))
						mIntentFilter++;
				}
			}
			scanner.setTotalIfCounter(tIntentFilter);
			scanner.setMalignIfCounter(mIntentFilter);
		}
	}

}
