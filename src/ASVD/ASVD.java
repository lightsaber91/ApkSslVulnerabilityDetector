package ASVD;

import java.io.IOException;
import javax.xml.parsers.ParserConfigurationException;
import org.xml.sax.SAXException;
import bytecode.*;

public final class ASVD {
	
	private static String apkName = null;
	private static boolean javaOutput = false;
	private static boolean xmlOutput = false;
	private static String decompilerDirectory = null;
	
	
	public static void main(String[] args) throws IOException, ParserConfigurationException, SAXException {
		
		parseArgs(args);
		if (apkName == null) {
			printHelp();
		}
		
		APK file = new APK(apkName);
		if(!file.getPermssion()) {
			System.out.println("App does not require INTERNET permission. No need to worry about SSL misuse... Abort!\n");
			file.close();
			System.exit(0);
		}
		//TODO tipo tutto
		file.close();
		
		System.exit(0);		
	}
	
	private static void printHelp() {
		System.out.println("Usage: asvd [-f APK] , [--file APK] : APK File to check");
		System.out.println("Options:\n   [-d DIR] , [--dir DIR] : Store decompiled App's Java code for further analysis in dir");
		System.out.println("   [-j] , [--java] : Show Java code for results for non-XML output");
		System.out.println("   [-x] , [--xml] : Print XML output");
		System.exit(0);
	}
	
	private static void parseArgs(String[] args) {
		
		for(int i = 0; i < args.length; i++) {
			if(args[i].compareTo("-h") == 0 || args[i].compareTo("--help") == 0) {
				printHelp();
			}
			else if(args[i].compareTo("-x") == 0 || args[i].compareTo("--xml") == 0) xmlOutput = true;
			else if(args[i].compareTo("-j") == 0 || args[i].compareTo("--java") == 0) javaOutput = true;
			else if(args[i].compareTo("-d") == 0 || args[i].compareTo("--dir") == 0) {
				if(i < args.length -1 && !args[i+1].startsWith("-"))
					decompilerDirectory = args[i+1];
			}
			else if(args[i].compareTo("-f") == 0 || args[i].compareTo("--file") == 0) {
				if(i < args.length -1 && !args[i+1].startsWith("-"))
					apkName = args[i+1];
			}
		}
		
	}


}
