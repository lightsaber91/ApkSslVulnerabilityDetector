package util;

import java.io.File;
import java.util.List;

public class Smali {
	
	public static void clearList(List<String> file, List<String> vul) {
		boolean[] exist = new boolean [file.size()];
		for(int i = 0; i < file.size(); i++) {
			exist[i] = false;
		}
		for(int i = 0; i < file.size(); i++) {
			boolean found = false;
			if(!exist[i]) {
				for(int j = 0; j < file.size(); j++) {
					if(i != j) {
						if(file.get(i).equals(file.get(j))) {
							found = true;
							exist[j] = true;
						}
					}
				}
				if(!found) {
					if(vul.get(i).equals(Const.VULNERABLE))
						vul.set(i, Const.V_NEVER_INVOKED);
					else
						vul.set(i, Const.M_NEVER_INVOKED);
				}
			}
		}
		for(int i = file.size(); i > 0; i--) {
			if(exist[i-1]) {
				file.remove(i-1);
				vul.remove(i-1);
			}
		}			
	}
	
	public static void modifyPaths(List<String> tm, List<String> hn, String src) {
		if(!tm.isEmpty()) {
			for(int i=0; i<tm.size(); i++) {
				tm.set(i, tm.get(i).substring(src.length()+1, tm.get(i).length() - ".smali".length()));
				tm.set(i, tm.get(i).replaceAll("/", "."));
			}
		}
		if(!hn.isEmpty()) {
			for(int i=0; i<hn.size(); i++) {
				hn.set(i, hn.get(i).substring(src.length()+1, hn.get(i).length() - ".smali".length()));
				hn.set(i, hn.get(i).replaceAll("/", "."));
			}
		}
	}

	public static void getSmaliFileList(File directory, List<File> filelist) {
		File[] files = directory.listFiles();
		if (files != null) {
			for (int i = 0; i < files.length; i++) {
				String fileName = files[i].getName();
				if (files[i].isDirectory()) {
					getSmaliFileList(files[i], filelist); 
				} else if(fileName.endsWith(Const.SMALI)){ 
					filelist.add(files[i]);
				} else {
					continue;
				}
			}

		}
	}
	
	public static void removeTmpFile(List<File> filelist, File dir) {
		if(filelist != null) {
			for(File file : filelist) {
				file.delete();
			}
		}
		File[] files = dir.listFiles();
	    for(int i=0; i<files.length; i++) {
	    	removeTmpFile(null, files[i]);
	    }
	    dir.delete();
	}
	
}
